import{j as e,B as I,b$ as Z,c0 as Q,c1 as ee,c2 as se,J as ae,W as V,Y as _,E as y,Z as G,$ as O,_ as k,r as m,H as C,z as L,a as f,a0 as te,a1 as R,a2 as le,a3 as ie,a4 as z,a5 as re,a6 as ne,a7 as q,i as oe,A as ce,c3 as de,c4 as pe,N as S,c5 as me,c6 as xe}from"./index-Cah9GgNi.js";import{G as F}from"./gift-CJDpdJoS.js";import{S as he}from"./sparkles-CJxx7LU5.js";import{E as ue}from"./ellipsis-BTTzz4hy.js";import{S as ge}from"./square-pen-oprSd4Jm.js";import{T as je}from"./trash-Cukg421D.js";import{C as be}from"./circle-dollar-sign-U1pwusAR.js";import{C as fe}from"./crown-4cfT-ZjR.js";import{u as ve,f as A,a as Ne,b as ye,g as we,c as Ce}from"./index-BXaOFAvc.js";import{L as w}from"./label-DJ1n1SI_.js";import{S as K,a as $,b as H,c as U,d as M}from"./select-DxUcbfzd.js";import{T as Ie,D as Pe}from"./data.not-found-BokaeWBd.js";import{I as Se,a as D}from"./IconX-D4kkSzeq.js";import{A as W}from"./index-Eb3V4Lej.js";import{I as Te}from"./IconFilter-D5y8yHeQ.js";import{D as ze,b as De,c as ke,d as Me,e as Ee}from"./dialog-CgcypPnB.js";import{L as Le}from"./loader-circle-D_OERo1u.js";import{C as Re}from"./circle-alert-CnaEjTQV.js";import{C as qe}from"./ConfirmModal-FgUfmtBl.js";import{T as Fe}from"./trophy-CRuQjySU.js";import{P as Ae}from"./plus-DCZtzpkq.js";import"./index-657d2hlm.js";import"./IconLoader-QBct0fFV.js";import"./triangle-alert-1qeuYxI_.js";const We=(d,u)=>[{accessorKey:"title",header:"Title",cell:({row:s})=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-amber-100 text-amber-600",children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-semibold text-gray-900",children:s.getValue("title")})]})},{accessorKey:"type",header:"Type",cell:({row:s})=>{const a=s.getValue("type"),b={FREE_PREMIUM:"bg-amber-50 text-amber-700 border-amber-200",GIFT_CARD:"bg-emerald-50 text-emerald-700 border-emerald-200"},p={FREE_PREMIUM:e.jsx(fe,{className:"h-3.5 w-3.5"}),GIFT_CARD:e.jsx(be,{className:"h-3.5 w-3.5"})};return e.jsxs(I,{variant:"outline",className:`${b[a]||"bg-gray-50"} flex w-fit items-center gap-1`,children:[p[a]||e.jsx(F,{className:"h-3.5 w-3.5"}),a]})}},{accessorKey:"value",header:"Value",cell:({row:s})=>e.jsx("span",{className:"font-medium text-gray-700",children:s.getValue("value")})},{accessorKey:"spinWheelLabel",header:"Wheel Label",cell:({row:s})=>{const a=s.getValue("spinWheelLabel");return a?e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"p-1 bg-amber-50 rounded-md",children:e.jsx(he,{className:"h-3.5 w-3.5 text-amber-500 animate-pulse"})}),e.jsx("span",{className:"text-sm font-medium text-slate-700 tracking-tight",children:a})]}):e.jsx("span",{className:"text-xs text-slate-400 font-mono",children:"-"})}},{accessorKey:"supportiveItems",header:"Supportive Items",cell:({row:s})=>{const a=s.original.supportiveItems||[];return a.length===0?e.jsx("span",{className:"text-sm text-gray-400",children:"-"}):e.jsxs("div",{className:"flex flex-wrap gap-1 max-w-[200px]",children:[a.slice(0,3).map((b,p)=>e.jsx(I,{variant:"secondary",className:"rounded-md bg-slate-100 px-2 py-0.5 text-[10px] font-medium text-slate-600 border-none transition-all duration-200 hover:bg-slate-200",children:b},p)),a.length>3&&e.jsx(Z,{children:e.jsxs(Q,{children:[e.jsx(ee,{children:e.jsxs(I,{variant:"outline",className:"rounded-md px-2 py-0.5 text-[10px] font-bold text-indigo-600 bg-indigo-50 border-indigo-100 transition-all duration-200 hover:scale-105",children:["+",a.length-3]})}),e.jsx(se,{children:e.jsx("p",{className:"text-xs",children:a.slice(3).join(", ")})})]})})]})}},{accessorKey:"createdAt",header:"Created",cell:({row:s})=>e.jsxs("div",{className:"flex items-center gap-1.5 text-gray-500 text-sm",children:[e.jsx(ae,{className:"h-3.5 w-3.5"}),new Date(s.getValue("createdAt")).toLocaleDateString()]})},{id:"actions",cell:({row:s})=>{const a=s.original;return e.jsxs(V,{children:[e.jsx(_,{asChild:!0,children:e.jsx(y,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(ue,{className:"h-4 w-4"})})}),e.jsxs(G,{align:"end",children:[e.jsx(O,{children:"Actions"}),e.jsxs(k,{onClick:()=>d(a),children:[e.jsx(ge,{className:"mr-2 h-4 w-4"})," Edit"]}),e.jsxs(k,{onClick:()=>u(a._id,a.title),className:"text-red-600 focus:bg-red-50",children:[e.jsx(je,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})}}];function Ve({columns:d,data:u,rowCount:s,pagination:a,onPaginationChange:b,searchPlaceholder:p="Search...",globalFilter:g,setGlobalFilter:i,isLoading:v,meta:N,filters:c}){const[j,t]=m.useState([]),n=ve({data:u,columns:d,rowCount:s,onSortingChange:t,manualSorting:!1,manualPagination:!0,manualFiltering:!0,onPaginationChange:b,onGlobalFilterChange:i,getSortedRowModel:Ce(),getCoreRowModel:we(),state:{sorting:j,pagination:a,globalFilter:g},meta:N}),x=c.prizeType;return e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row md:items-center justify-between gap-4 bg-slate-50/50 p-2 rounded-xl",children:[e.jsxs("div",{className:"relative w-3/5 md:w-1/3",children:[e.jsx(Se,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 z-10"}),e.jsx(C,{placeholder:p,className:"pl-9 pr-10 bg-white border-slate-200 h-10 shadow-md focus-visible:ring-brand-aqua rounded-lg",value:g??"",onChange:r=>i(r.target.value)}),g&&e.jsx("button",{onClick:()=>i(""),className:"absolute right-3 top-1/2 -translate-y-1/2 group flex items-center justify-center rounded-full p-1 bg-brand-aqua/30 hover:bg-brand-aqua transition-colors duration-200","aria-label":"Clear search",children:e.jsx(D,{className:"h-4 w-4 text-slate-600 group-hover:text-slate-800 transition-colors"})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 min-w-0 flex-1 ml-4",children:[e.jsx("div",{className:"hidden sm:flex flex-1 items-center justify-end gap-2 overflow-x-hidden min-w-0",children:e.jsx(W,{mode:"popLayout",children:c.prizeType&&e.jsx(L.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,scale:.95},className:"shrink-0",children:e.jsxs(I,{variant:"secondary",className:"p-2 gap-1 bg-indigo-100 border-dashed border-indigo-400 text-indigo-700 shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase opacity-50",children:"Type:"}),e.jsx("span",{className:"capitalize text-xs",children:c.prizeType}),e.jsx("button",{onClick:()=>c.setPrizeType(""),className:"ml-1 p-0.5 rounded-full hover:bg-slate-100 transition-colors",children:e.jsx(D,{size:12})})]})},"status-chip")})}),x&&e.jsx("div",{className:"hidden sm:block w-0.5 h-6 bg-slate-200 shrink-0"}),e.jsx("div",{className:"shrink-0",children:e.jsxs(V,{children:[e.jsx(_,{asChild:!0,children:e.jsxs(y,{variant:"outline",className:f("h-10 border-brand-aqua/80 shadow-sm bg-brand-aqua/5 hover:bg-brand-aqua/30 transition-all whitespace-nowrap",x&&"border-brand-aqua ring-1 ring-brand-aqua"),children:[e.jsx(Te,{strokeWidth:2.5,className:f("h-6 w-6",x?"text-brand-aqua":"text-brand-aqua/60")}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Filters"}),x&&e.jsx("span",{className:"ml-2 flex h-5 w-5 items-center justify-center rounded-full bg-brand-aqua text-[10px] text-white font-bold",children:+!!c.prizeType})]})}),e.jsxs(G,{align:"end",className:"w-44 p-2 shadow-xl border-slate-200",children:[e.jsx(O,{className:"text-xs text-slate-500 font-bold uppercase tracking-wider",children:"Prizes Type"}),["GIFT_CARD","FREE_PREMIUM"].map(r=>e.jsx(te,{className:"capitalize",checked:c.prizeType===r,onCheckedChange:()=>c.setPrizeType(r),children:r},r)),e.jsx(R,{}),x&&e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsx(k,{className:"text-red-600 justify-center font-medium focus:bg-red-50 focus:text-red-700 cursor-pointer",onClick:()=>{c.setPrizeType("")},children:"Clear All Filters"})]})]})]})})]})]}),e.jsx("div",{className:"flex justify-end sm:hidden flex-wrap gap-2 px-1",children:e.jsx(W,{children:x&&e.jsx(L.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex flex-wrap items-center gap-2",children:c.prizeType&&e.jsxs(I,{variant:"secondary",className:"bg-indigo-50 text-indigo-700 border-indigo-100 py-1",children:["Status:",e.jsx("span",{className:"capitalize ml-1",children:c.prizeType}),e.jsx("button",{onClick:()=>c.setPrizeType(""),className:"ml-1",children:e.jsx(D,{size:12})})]})})})})]}),e.jsx("div",{className:"block rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden",children:e.jsxs(le,{children:[e.jsx(ie,{className:"bg-slate-50/50",children:n.getHeaderGroups().map(r=>e.jsx(z,{children:r.headers.map(h=>e.jsx(re,{className:"text-slate-700 w-max pl-10 font-semibold h-10 bg-slate-100 text-xs",children:A(h.column.columnDef.header,h.getContext())},h.id))},r.id))}),e.jsx(ne,{className:f(v&&"opacity-50 pointer-events-none transition-opacity"),children:n.getRowModel().rows?.length?n.getRowModel().rows.map(r=>e.jsx(z,{className:"hover:bg-slate-50/50",children:r.getVisibleCells().map(h=>e.jsx(q,{className:"py-3 pl-10",children:A(h.column.columnDef.cell,h.getContext())},h.id))},r.id)):e.jsx(z,{children:e.jsx(q,{colSpan:d.length,className:"h-64 text-center",children:v?e.jsx(Ie,{text:"Fetching data..."}):e.jsx(Pe,{message:"No results found for your search"})})})})]})}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-4 py-2 border-t border-slate-100 mt-4 px-5 md:px-0",children:[e.jsxs("div",{className:"text-xs font-medium text-slate-500",children:["Showing ",u.length," of ",s," results"]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"hidden sm:block text-[10px] font-bold text-slate-400 uppercase",children:"Rows"}),e.jsxs(K,{value:`${n.getState().pagination.pageSize}`,onValueChange:r=>n.setPageSize(Number(r)),children:[e.jsx($,{className:"h-8 w-[70px] text-xs",children:e.jsx(H,{})}),e.jsx(U,{children:[10,20,50].map(r=>e.jsx(M,{value:`${r}`,children:r},r))})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(y,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>n.previousPage(),disabled:!n.getCanPreviousPage(),children:e.jsx(Ne,{size:16})}),e.jsxs("div",{className:"text-xs font-semibold px-2",children:[n.getState().pagination.pageIndex+1," /"," ",n.getPageCount()]}),e.jsx(y,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>n.nextPage(),disabled:!n.getCanNextPage(),children:e.jsx(ye,{size:16})})]})]})]})]})}const _e=({isOpen:d,onOpenChange:u,form:s,setForm:a,onSubmit:b,loading:p,isEditing:g})=>{const[i,v]=m.useState({});m.useEffect(()=>{d||v({})},[d]);const N=()=>{const t={};s.title?.trim()||(t.title="Prize title is required"),s.type||(t.type="Please select a prize type"),!s.value||isNaN(s.value)?t.value="Valid value is required":Number(s.value)<=0&&(t.value="Value must be greater than 0"),s.spinWheelLabel?.trim()||(t.spinWheelLabel="Spin wheel label is required");const n=s.supportiveItems?.split(",").filter(x=>x.trim()!=="");return(!n||n.length<2)&&(t.supportiveItems="At least 2 supportive items are recommended"),v(t),Object.keys(t).length===0},c=()=>{N()&&b()},j=({msg:t})=>e.jsxs("p",{className:"text-[10px] font-medium text-red-500 flex items-center gap-1 mt-1",children:[e.jsx(Re,{className:"h-3 w-3"})," ",t]});return e.jsx(ze,{open:d,onOpenChange:u,children:e.jsxs(De,{className:"sm:max-w-[500px] gap-0 p-0 overflow-hidden border-none shadow-2xl",children:[e.jsx(ke,{className:"p-6 bg-slate-900 text-white",children:e.jsx(Me,{className:"text-xl font-bold tracking-tight",children:g?"Update Prize Details":"Create New Prize Asset"})}),e.jsxs("div",{className:"p-6 space-y-5 bg-white",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(w,{className:"text-xs font-bold uppercase text-slate-500",children:"Prize Title"}),e.jsx(C,{value:s.title,onChange:t=>a({...s,title:t.target.value}),placeholder:"e.g. Premium Membership",className:f("h-11",i.title&&"border-red-500 focus-visible:ring-red-500")}),i.title&&e.jsx(j,{msg:i.title})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(w,{className:"text-xs font-bold uppercase text-slate-500",children:"Type"}),e.jsxs(K,{value:s.type,onValueChange:t=>a({...s,type:t}),children:[e.jsx($,{className:f("h-11",i.type&&"border-red-500"),children:e.jsx(H,{placeholder:"Select type"})}),e.jsxs(U,{children:[e.jsx(M,{value:"FREE_PREMIUM",children:"Free Premium"}),e.jsx(M,{value:"GIFT_CARD",children:"Gift Card"})]})]}),i.type&&e.jsx(j,{msg:i.type})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(w,{className:"text-xs font-bold uppercase text-slate-500",children:"Value"}),e.jsx(C,{type:"number",value:s.value,onChange:t=>a({...s,value:t.target.value}),className:f("h-11",i.value&&"border-red-500 focus-visible:ring-red-500")}),i.value&&e.jsx(j,{msg:i.value})]})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(w,{className:"text-xs font-bold uppercase text-slate-500",children:"Spin Wheel Label"}),e.jsx(C,{value:s.spinWheelLabel,placeholder:"Display text on wheel",onChange:t=>a({...s,spinWheelLabel:t.target.value}),className:f("h-11",i.spinWheelLabel&&"border-red-500 focus-visible:ring-red-500")}),i.spinWheelLabel&&e.jsx(j,{msg:i.spinWheelLabel})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsx(w,{className:"text-xs font-bold uppercase text-slate-500",children:"Supportive Items"}),e.jsx(C,{value:s.supportiveItems,onChange:t=>a({...s,supportiveItems:t.target.value}),placeholder:"Item 1, Item 2, Item 3",className:f("h-11",i.supportiveItems&&"border-amber-400 focus-visible:ring-amber-400")}),e.jsx("p",{className:"text-[10px] text-slate-400 italic",children:"Separate items with commas"}),i.supportiveItems&&e.jsx(j,{msg:i.supportiveItems})]})]}),e.jsxs(Ee,{className:"p-6 bg-slate-50 border-t flex items-center gap-3",children:[e.jsx(y,{variant:"ghost",onClick:()=>u(!1),className:"font-semibold text-slate-500",children:"Cancel"}),e.jsx(y,{onClick:c,disabled:p,className:"bg-slate-900 hover:bg-slate-800 text-white min-w-[140px] h-11 shadow-lg shadow-slate-200",children:p?e.jsx(Le,{className:"h-4 w-4 animate-spin mr-2"}):g?"Save Changes":"Create Prize"})]})]})})};function ms(){const d=oe(),{prizes:u,pagination:s,loading:a,error:b}=ce(l=>l.prize),[p,g]=m.useState({pageIndex:0,pageSize:10}),[i,v]=m.useState(""),[N,c]=m.useState(""),[j,t]=m.useState(!1),[n,x]=m.useState(null),[r,h]=m.useState({title:"",type:"",value:"",spinWheelLabel:"",supportiveItems:""}),[P,T]=m.useState({isOpen:!1,prizeId:null,title:""});m.useEffect(()=>{const l=setTimeout(()=>{d(de({page:p.pageIndex+1,limit:p.pageSize,search:i,type:N}))},500);return()=>clearTimeout(l)},[d,p.pageIndex,p.pageSize,i,N]);const E=()=>{h({title:"",type:"",value:"",spinWheelLabel:"",supportiveItems:""}),x(null)},B=l=>{console.log("prize edit: ",l),h({title:l.title||"",type:l.type||"",value:l.value?l.value.toString():"",spinWheelLabel:l.spinWheelLabel||"",supportiveItems:l.supportiveItems?l.supportiveItems.join(", "):""}),x(l._id),t(!0)},J=async()=>{const l={...r,value:parseFloat(r.value),supportiveItems:r.supportiveItems.split(",").map(o=>o.trim()).filter(o=>o!=="")};try{if(n){const o=await d(pe({id:n,data:l})).unwrap();S.success(o.message||"Prize updated successfully")}else{const o=await d(me(l)).unwrap();S.success(o.message||"Prize created successfully")}t(!1),E(),console.log("editingId: ",n),console.log("data: ",l)}catch(o){console.error("Submission failed:",o)}},X=m.useMemo(()=>We(B,(l,o)=>{T({isOpen:!0,prizeId:l,title:o})}),[u]),Y=async()=>{try{const l=await d(xe(P.prizeId)).unwrap();S.success(l.message||"Prize deleted successfully"),T(o=>({...o,isOpen:!1}))}catch(l){S.error(l||"Failed to delete prize")}};return e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-brand-aqua p-3 rounded-xl shadow-lg",children:e.jsx(Fe,{className:"text-white h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Prizes"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your giveaway pool"})]})]}),e.jsxs(y,{onClick:()=>{E(),t(!0)},className:"bg-brand-aqua/20 hover:bg-brand-aqua/60 border border-brand-aqua text-slate-800 font-semibold gap-2 h-11 px-4 shadow-sm shadow-neutral-400",children:[e.jsx(Ae,{className:"h-4 w-4"})," Create New Prize"]})]}),e.jsx("div",{className:"overflow-hidden",children:e.jsx(Ve,{columns:X,data:u||[],rowCount:s?.total||0,isLoading:a,pagination:p,onPaginationChange:g,globalFilter:i,setGlobalFilter:l=>{v(l),g(o=>({...o,pageIndex:0}))},searchPlaceholder:"Search by title...",filters:{prizeType:N,setPrizeType:l=>{c(l),g(o=>({...o,pageIndex:0}))}}})}),e.jsx(_e,{isOpen:j,onOpenChange:t,form:r,setForm:h,onSubmit:J,loading:a,isEditing:!!n}),e.jsx(qe,{isOpen:P.isOpen,onClose:()=>T({...P,isOpen:!1}),onConfirm:Y,title:"Delete Prize?",message:`Are you sure you want to delete "${P.title}"? This will permanently remove it from the giveaway pool.`,confirmText:"Delete Permanently",type:"danger",loading:a})]})}export{ms as default};
