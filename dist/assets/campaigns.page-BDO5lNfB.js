import{D as H,r as m,j as e,H as W,z as L,B as O,W as $,Y as G,E as N,a as y,Z as K,$ as U,a0 as re,a1 as ie,_ as D,a2 as ce,a3 as oe,a4 as k,a5 as de,a6 as me,a7 as q,J as xe,ah as J,i as pe,A as F,c3 as he,c7 as ge,c8 as ue,N as w,c9 as fe,ca as je,cb as be,cc as we}from"./index-Cah9GgNi.js";import{u as Ne,f as R,a as ye,b as Ce,g as ve,c as De}from"./index-BXaOFAvc.js";import{L as Se}from"./label-DJ1n1SI_.js";import{S as X,a as Y,b as Z,c as Q,d as ee}from"./select-DxUcbfzd.js";import{T as Ie,D as ke}from"./data.not-found-BokaeWBd.js";import{I as ze,a as z}from"./IconX-D4kkSzeq.js";import{A as V}from"./index-Eb3V4Lej.js";import{I as Me}from"./IconFilter-D5y8yHeQ.js";import{G as ae}from"./gift-CJDpdJoS.js";import{A as Ee}from"./award-CjYD8FNm.js";import{E as Pe}from"./ellipsis-BTTzz4hy.js";import{S as Te}from"./square-pen-oprSd4Jm.js";import{T as Ae}from"./trash-Cukg421D.js";import{C as Le}from"./clock-BveIEetd.js";import{C as Oe}from"./circle-check-big-ChBinIN1.js";import{f as qe}from"./formatDistanceToNow-SCnc4N16.js";import{D as Fe,b as Re,c as Ve,d as _e,e as Be}from"./dialog-CgcypPnB.js";import{P as _,C as He,M as We}from"./pen-EW22sn6S.js";import{P as M}from"./plus-DCZtzpkq.js";import{C as B}from"./circle-alert-CnaEjTQV.js";import{T as $e}from"./trophy-CRuQjySU.js";import{L as Ge}from"./loader-circle-D_OERo1u.js";import{C as Ke}from"./ConfirmModal-FgUfmtBl.js";import{p as Ue}from"./parseISO-CSd47LLW.js";import"./index-657d2hlm.js";import"./IconLoader-QBct0fFV.js";import"./endOfMonth-D35K41iH.js";import"./triangle-alert-1qeuYxI_.js";const Je=[["path",{d:"M11.636 6A13 13 0 0 0 19.4 3.2 1 1 0 0 1 21 4v11.344",key:"bycexp"}],["path",{d:"M14.378 14.357A13 13 0 0 0 11 14H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h1",key:"1t17s6"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M6 14a12 12 0 0 0 2.4 7.2 2 2 0 0 0 3.2-2.4A8 8 0 0 1 10 14",key:"1853fq"}],["path",{d:"M8 8v6",key:"aieo6v"}]],Xe=H("megaphone-off",Je);const Ye=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],Ze=H("power-off",Ye);function Qe({columns:c,data:j,rowCount:x,pagination:n,onPaginationChange:t,searchPlaceholder:r="Search...",globalFilter:d,setGlobalFilter:p,isLoading:i,meta:f,filters:o}){const[C,b]=m.useState([]),s=Ne({data:j,columns:c,rowCount:x,onSortingChange:b,manualSorting:!1,manualPagination:!0,manualFiltering:!0,onPaginationChange:t,onGlobalFilterChange:p,getSortedRowModel:De(),getCoreRowModel:ve(),state:{sorting:C,pagination:n,globalFilter:d},meta:f}),h=o.drawStatus;return e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row md:items-center justify-between gap-4 bg-slate-50/50 p-2 rounded-xl",children:[e.jsxs("div",{className:"relative w-3/5 md:w-1/3",children:[e.jsx(ze,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 z-10"}),e.jsx(W,{placeholder:r,className:"pl-9 pr-10 bg-white border-slate-200 h-10 shadow-md focus-visible:ring-brand-aqua rounded-lg",value:d??"",onChange:l=>p(l.target.value)}),d&&e.jsx("button",{onClick:()=>p(""),className:"absolute right-3 top-1/2 -translate-y-1/2 group flex items-center justify-center rounded-full p-1 bg-brand-aqua/30 hover:bg-brand-aqua transition-colors duration-200","aria-label":"Clear search",children:e.jsx(z,{className:"h-4 w-4 text-slate-600 group-hover:text-slate-800 transition-colors"})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 min-w-0 flex-1 ml-4",children:[e.jsx("div",{className:"hidden sm:flex flex-1 items-center justify-end gap-2 overflow-x-hidden min-w-0",children:e.jsx(V,{mode:"popLayout",children:h&&e.jsx(L.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,scale:.95},className:"shrink-0",children:e.jsxs(O,{variant:"secondary",className:"p-2 gap-1 bg-indigo-100 border-dashed border-indigo-400 text-indigo-700 shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase opacity-50",children:"Status:"}),e.jsx("span",{className:"capitalize text-xs",children:o.drawStatus}),e.jsx("button",{onClick:()=>o.setDrawStatus(""),className:"ml-1 p-0.5 rounded-full hover:bg-slate-100 transition-colors",children:e.jsx(z,{size:12})})]})},"status-chip")})}),h&&e.jsx("div",{className:"hidden sm:block w-0.5 h-6 bg-slate-200 shrink-0"}),e.jsx("div",{className:"shrink-0",children:e.jsxs($,{children:[e.jsx(G,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:y("h-10 border-brand-aqua/80 shadow-sm bg-brand-aqua/5 hover:bg-brand-aqua/30 transition-all whitespace-nowrap",h&&"border-brand-aqua ring-1 ring-brand-aqua"),children:[e.jsx(Me,{strokeWidth:2.5,className:y("h-6 w-6",h?"text-brand-aqua":"text-brand-aqua/60")}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Filters"}),h&&e.jsx("span",{className:"ml-2 flex h-5 w-5 items-center justify-center rounded-full bg-brand-aqua text-[10px] text-white font-bold",children:+!!o.drawStatus})]})}),e.jsxs(K,{align:"end",className:"w-44 p-2 shadow-xl",children:[e.jsx(U,{className:"text-xs text-slate-500 font-bold uppercase",children:"Campaign View"}),[{label:"Active",value:"ACTIVE"},{label:"Disabled",value:"DISABLED"},{label:"Completed",value:"COMPLETED"}].map(l=>e.jsx(re,{className:"capitalize",checked:o.drawStatus===l.value,onCheckedChange:()=>o.setDrawStatus(l.value),children:l.label},l.value)),h&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{}),e.jsx(D,{className:"text-red-600 justify-center font-medium focus:bg-red-50 focus:text-red-700 cursor-pointer",onClick:()=>{o.setDrawStatus("")},children:"Clear All Filters"})]})]})]})})]})]}),e.jsx("div",{className:"flex justify-end sm:hidden flex-wrap gap-2 px-1",children:e.jsx(V,{children:h&&e.jsx(L.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex flex-wrap items-center gap-2",children:o.drawStatus&&e.jsxs(O,{variant:"secondary",className:"bg-indigo-50 text-indigo-700 border-indigo-100 py-1",children:["Status:",e.jsx("span",{className:"capitalize ml-1",children:o.drawStatus}),e.jsx("button",{onClick:()=>o.setDrawStatus(""),className:"ml-1",children:e.jsx(z,{size:12})})]})})})})]}),e.jsx("div",{className:"block rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden",children:e.jsxs(ce,{children:[e.jsx(oe,{className:"bg-slate-50/50",children:s.getHeaderGroups().map(l=>e.jsx(k,{children:l.headers.map(u=>e.jsx(de,{className:"text-slate-700 w-max pl-10 font-semibold h-10 bg-slate-100 text-xs",children:R(u.column.columnDef.header,u.getContext())},u.id))},l.id))}),e.jsx(me,{className:y(i&&"opacity-50 pointer-events-none transition-opacity"),children:s.getRowModel().rows?.length?s.getRowModel().rows.map(l=>e.jsx(k,{className:"hover:bg-slate-50/50",children:l.getVisibleCells().map(u=>e.jsx(q,{className:"py-3 pl-10",children:R(u.column.columnDef.cell,u.getContext())},u.id))},l.id)):e.jsx(k,{children:e.jsx(q,{colSpan:c.length,className:"h-64 text-center",children:i?e.jsx(Ie,{text:"Fetching Campaigns..."}):e.jsx(ke,{message:"No campaigns found"})})})})]})}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-4 py-2 border-t border-slate-100 mt-4 px-5 md:px-0",children:[e.jsxs("div",{className:"text-xs font-medium text-slate-500",children:["Showing ",j.length," of ",x," results"]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Se,{className:"hidden sm:block text-[10px] font-bold text-slate-400 uppercase",children:"Rows"}),e.jsxs(X,{value:`${s.getState().pagination.pageSize}`,onValueChange:l=>s.setPageSize(Number(l)),children:[e.jsx(Y,{className:"h-8 w-[70px] text-xs",children:e.jsx(Z,{})}),e.jsx(Q,{children:[10,20,50].map(l=>e.jsx(ee,{value:`${l}`,children:l},l))})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:e.jsx(ye,{size:16})}),e.jsxs("div",{className:"text-xs font-semibold px-2",children:[s.getState().pagination.pageIndex+1," /"," ",s.getPageCount()]}),e.jsx(N,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:e.jsx(Ce,{size:16})})]})]})]})]})}const ea=(c,j,x)=>[{accessorKey:"date",header:"Date",cell:({row:n})=>{const t=n.original?.date;if(!t)return e.jsx("span",{className:"text-sm text-slate-400 italic",children:"â€”"});const r=new Date(t);return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium text-slate-900",children:qe(r,{addSuffix:!0})}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500",children:[e.jsx(xe,{className:"h-2.5 w-2.5 opacity-70"}),e.jsx("span",{children:J(r,"MMM dd, yyyy p")})]})]})}},{accessorKey:"prize.title",header:"Prize",cell:({row:n})=>{const t=n.original.prize;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-4 w-4 text-slate-900"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-slate-900",children:t?.title||"-"}),t?.spinWheelLabel&&e.jsx("span",{className:"text-[10px] text-gray-500 italic",children:t.spinWheelLabel})]})]})}},{accessorKey:"drawStatus",header:"Status",cell:({row:n})=>{const{drawStatus:t,isActive:r}=n.original,d=t==="COMPLETED"?"COMPLETED":r?"ACTIVE":"DISABLED",p={COMPLETED:{className:"bg-green-50 border-green-200 text-green-700",icon:e.jsx(Oe,{className:"h-3 w-3"})},ACTIVE:{className:"bg-emerald-50 border-emerald-200 text-emerald-700",icon:e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-emerald-500"})]})},DISABLED:{className:"bg-slate-100 border-slate-300 text-slate-600",icon:e.jsx(Xe,{className:"h-3 w-3"})},PENDING:{className:"bg-amber-50 border-amber-200 text-amber-700",icon:e.jsx(Le,{className:"h-3 w-3"})}},i=p[d]||p.DISABLED;return e.jsx("div",{className:"flex",children:e.jsxs("span",{className:y("inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-[10px] font-bold tracking-wider uppercase transition-colors",i.className),children:[i.icon,d]})})}},{accessorKey:"winner",header:"Winner",cell:({row:n})=>{const t=n.original.winner;return t&&(t.email||t.phone)?e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-bold text-slate-900 text-sm",children:t.email||t.phone})]})}):e.jsx("span",{className:"text-sm text-slate-400 italic",children:"No winner yet"})}},{id:"actions",header:()=>e.jsx("div",{className:"w-max text-center mr-4 text-xs",children:"Actions"}),cell:({row:n})=>{const t=n.original,r=t.drawStatus!=="COMPLETED"&&t.isActive;return e.jsxs($,{children:[e.jsx(G,{asChild:!0,children:e.jsx(N,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(Pe,{className:"h-4 w-4"})})}),e.jsxs(K,{align:"end",children:[e.jsx(U,{children:"Actions"}),e.jsxs(D,{onClick:()=>c(t),children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),"Edit Campaign"]}),r&&e.jsxs(D,{className:"text-amber-600",onClick:()=>x(t._id),children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"})," Disable Campaign"]}),e.jsxs(D,{className:"text-red-600 focus:bg-red-50",onClick:()=>j(t?._id,t?.date),children:[e.jsx(Ae,{className:"mr-2 h-4 w-4"})," Delete"]})]})]})}}],aa=({isOpen:c,onClose:j,editMode:x,form:n,setForm:t,prizes:r=[],loading:d,submit:p})=>{const[i,f]=m.useState({});m.useEffect(()=>{c||f({})},[c]);const o=Array.isArray(r)?r:[],C=()=>{const s={};if(!n.date)s.date="Campaign date is required";else{const h=new Date(n.date),l=new Date;l.setHours(0,0,0,0),!x&&h<l&&(s.date="Date cannot be in the past")}return n.prizeId||(s.prizeId="Please select a prize for this campaign"),f(s),Object.keys(s).length===0},b=()=>{C()&&p()};return e.jsx(Fe,{open:c,onOpenChange:j,children:e.jsxs(Re,{className:"max-w-md border-none p-0 overflow-hidden sm:max-w-lg",children:[e.jsx(Ve,{className:"bg-gray-50/80 px-6 py-4 border-b border-gray-100",children:e.jsxs(_e,{className:"flex items-center gap-2 text-lg font-bold text-gray-800",children:[x?e.jsx(_,{className:"h-5 w-5 text-amber-500"}):e.jsx(M,{className:"h-5 w-5 text-black"}),x?"Edit Campaign":"Create New Campaign"]})}),e.jsx("div",{className:"space-y-6 px-6 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 gap-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700",children:[e.jsx(He,{className:"h-4 w-4 text-gray-500"}),"Campaign Date"]}),e.jsx(W,{type:"date",value:n.date,onChange:s=>{t({...n,date:s.target.value}),i.date&&f({...i,date:null})},className:y("h-11 border-gray-200 transition-all",i.date&&"border-red-500 focus:ring-red-200"),min:x?void 0:new Date().toISOString().split("T")[0]}),i.date&&e.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1 mt-1 font-medium",children:[e.jsx(B,{className:"h-3 w-3"})," ",i.date]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-semibold text-gray-700",children:[e.jsx($e,{className:"h-4 w-4 text-gray-500"}),"Select Prize"]}),e.jsxs(X,{value:n.prizeId,onValueChange:s=>{t({...n,prizeId:s}),i.prizeId&&f({...i,prizeId:null})},children:[e.jsx(Y,{className:y("h-11 border-gray-200 transition-all",i.prizeId&&"border-red-500 focus:ring-red-200"),children:e.jsx(Z,{placeholder:"Choose a campaign prize"})}),e.jsx(Q,{children:o.length===0?e.jsx("div",{className:"p-3 text-sm text-center text-gray-500",children:"No active prizes available"}):o.filter(s=>s&&s.isActive).map(s=>e.jsx(ee,{value:s._id,className:"py-2",children:e.jsxs("span",{className:"flex items-center gap-2 font-medium",children:[e.jsx(ae,{className:"h-4 w-4 text-amber-500"}),s.title]})},s._id))})]}),i.prizeId&&e.jsxs("p",{className:"text-xs text-red-500 flex items-center gap-1 mt-1 font-medium",children:[e.jsx(B,{className:"h-3 w-3"})," ",i.prizeId]})]})]})}),e.jsxs(Be,{className:"bg-gray-50/80 px-6 py-4 border-t border-gray-100 flex items-center gap-3",children:[e.jsx(N,{variant:"ghost",onClick:j,className:"text-gray-500 hover:bg-gray-200",children:"Cancel"}),e.jsx(N,{onClick:b,disabled:d,className:"h-11 px-8 gap-2 bg-black hover:bg-zinc-800 text-white font-semibold transition-all shadow-md active:scale-95",children:d?e.jsx(Ge,{className:"h-4 w-4 animate-spin"}):x?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4"})," Update Campaign"]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4"})," Create Campaign"]})})]})]})})};function Ma(){const c=pe(),{prizes:j}=F(a=>a.prize),{campaigns:x,pagination:n,loading:t}=F(a=>a.campaign),[r,d]=m.useState({pageIndex:0,pageSize:10}),[p,i]=m.useState(""),[f,o]=m.useState(""),[C,b]=m.useState(!1),[s,h]=m.useState(null),[l,u]=m.useState({date:"",prizeId:""}),[v,S]=m.useState({isOpen:!1,id:null,title:""});m.useEffect(()=>{c(he())},[c]),m.useEffect(()=>{const a=setTimeout(()=>{c(ge({page:r.pageIndex+1,limit:r.pageSize,search:p,drawStatus:f}))},500);return()=>clearTimeout(a)},[c,r.pageIndex,r.pageSize,p,f]);const I=()=>{u({date:"",prizeId:""}),h(null)},E=a=>{console.log("campaign edit: ",a),u({date:a.date?new Date(a.date).toISOString().split("T")[0]:"",prizeId:a.prize?._id||a.prizeId}),h(a._id),b(!0)},se=async()=>{try{if(s){const a=await c(ue({id:s,data:l})).unwrap();w.success(a.message||"Campaign updated successfully")}else{const a=await c(fe(l)).unwrap();w.success(a.message||"Campaign created successfully")}b(!1),I()}catch(a){w.error(a),b(!1)}},P=(a,g)=>{const A=typeof g=="string"?Ue(g):new Date(g),ne=je(A)?J(A,"MMM dd, yyyy"):"Unknown Date";S({isOpen:!0,id:a,title:ne})},te=async()=>{try{console.log("confirmDelete.id: ",v?.id);const a=await c(be(v?.id)).unwrap();S({isOpen:!1,id:null,title:""}),w.success(a.message||"Campaign deleted successfully")}catch(a){console.error("error: ",a),w.error(a||"Failed to delete campaign")}},T=async a=>{try{const g=await c(we(a)).unwrap();w.success(g.message||"Campaign disabled successfully")}catch(g){console.error("error: ",g),w.error(g||"Failed to disable campaign")}},le=m.useMemo(()=>ea(E,P,T),[E,P,T]);return e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-brand-aqua p-3 rounded-xl shadow-lg",children:e.jsx(We,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Campaigns"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Manage your giveaway campaigns"})]})]}),e.jsxs(N,{onClick:()=>{I(),b(!0)},className:"bg-brand-aqua/20 hover:bg-brand-aqua/60 border border-brand-aqua text-slate-800 font-semibold gap-2 h-11 px-4 shadow-sm shadow-neutral-400",children:[e.jsx(M,{className:"h-4 w-4"})," Create New Campaign"]})]}),e.jsx("div",{className:"overflow-hidden",children:e.jsx(Qe,{columns:le,data:x||[],rowCount:n?.total||0,isLoading:t,pagination:r,onPaginationChange:d,globalFilter:p,setGlobalFilter:a=>{i(a),d(g=>({...g,pageIndex:0}))},searchPlaceholder:"Search by title...",filters:{drawStatus:f,setDrawStatus:a=>{o(a),d(g=>({...g,pageIndex:0}))}}})}),e.jsx(aa,{isOpen:C,onClose:()=>{b(!1),I()},form:l,setForm:u,prizes:j,submit:se,loading:t,editMode:!!s}),e.jsx(Ke,{isOpen:v.isOpen,onClose:()=>S(a=>({...a,isOpen:!1})),onConfirm:te,title:"Delete Campaign",message:`Are you sure you want to delete the campaign for ${v.title}?`,confirmText:"Delete Permanently",type:"danger",loading:t})]})}export{Ma as default};
