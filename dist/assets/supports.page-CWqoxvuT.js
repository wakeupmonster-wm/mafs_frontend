import{D as J,r as m,j as e,H as Q,z as M,B as f,W as L,Y as O,E as N,a as D,Z as V,$ as H,a0 as ee,a1 as P,_ as k,a2 as se,a3 as ae,a4 as I,a5 as te,a6 as re,a7 as z,O as le,P as ie,M as ne,ah as oe,s as K,i as ce,a8 as de,A as xe,aH as A,aL as R,aK as me}from"./index-Cah9GgNi.js";import{P as he}from"./headSubhead-C7X6Yce6.js";import{u as pe,f as q,a as ue,b as ge,g as be,c as je}from"./index-BXaOFAvc.js";import{L as fe}from"./label-DJ1n1SI_.js";import{S as $,a as U,b as B,c as W,d as w}from"./select-DxUcbfzd.js";import{T as Ne,D as ye}from"./data.not-found-BokaeWBd.js";import{I as ve,a as F}from"./IconX-D4kkSzeq.js";import{A as _}from"./index-Eb3V4Lej.js";import{I as we}from"./IconFilter-D5y8yHeQ.js";import{A as E}from"./arrow-up-down-CNYF-QmJ.js";import{C as Ce}from"./clock-BveIEetd.js";import{C as ke}from"./circle-check-big-ChBinIN1.js";import{C as Se}from"./circle-x-D3br8V_4.js";import{E as Te}from"./ellipsis-BTTzz4hy.js";import{E as De}from"./eye-Ud1Tzidn.js";import{M as X}from"./message-square-BxRcthbj.js";import{T as Ie}from"./trash-Cukg421D.js";import{f as Fe}from"./formatDistanceToNow-SCnc4N16.js";import{D as Me,b as Pe,d as ze}from"./dialog-CgcypPnB.js";import{T as Ae}from"./textarea-BdgJi3SO.js";import{C as Re}from"./ConfirmModal-FgUfmtBl.js";import{I as qe}from"./inbox-DEJGmHq1.js";import"./index-657d2hlm.js";import"./IconLoader-QBct0fFV.js";import"./endOfMonth-D35K41iH.js";import"./triangle-alert-1qeuYxI_.js";const _e=[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]],Ee=J("send-horizontal",_e);function Le({columns:p,data:x,rowCount:s,pagination:a,onPaginationChange:l,searchPlaceholder:n="Search...",globalFilter:c,setGlobalFilter:d,isLoading:g,meta:C,filters:r}){const[j,b]=m.useState([]),o=pe({data:x,columns:p,rowCount:s,onSortingChange:b,manualSorting:!1,manualPagination:!0,manualFiltering:!0,onPaginationChange:l,onGlobalFilterChange:d,getSortedRowModel:je(),getCoreRowModel:be(),state:{sorting:j,pagination:a,globalFilter:c},meta:C}),u=r.statusFilter;return e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row md:items-center justify-between gap-4 bg-slate-50/50 p-2 rounded-xl",children:[e.jsxs("div",{className:"relative w-3/5 md:w-1/3",children:[e.jsx(ve,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 z-10"}),e.jsx(Q,{placeholder:n,className:"pl-9 pr-10 bg-white border-slate-200 h-10 shadow-md focus-visible:ring-brand-aqua rounded-lg",value:c??"",onChange:t=>d(t.target.value)}),c&&e.jsx("button",{onClick:()=>d(""),className:"absolute right-3 top-1/2 -translate-y-1/2 group flex items-center justify-center rounded-full p-1 bg-brand-aqua/30 hover:bg-brand-aqua transition-colors duration-200","aria-label":"Clear search",children:e.jsx(F,{className:"h-4 w-4 text-slate-600 group-hover:text-slate-800 transition-colors"})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 min-w-0 flex-1 ml-4",children:[e.jsx("div",{className:"hidden sm:flex flex-1 items-center justify-end gap-2 overflow-x-hidden min-w-0",children:e.jsx(_,{mode:"popLayout",children:r.statusFilter&&e.jsx(M.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,scale:.95},className:"shrink-0",children:e.jsxs(f,{variant:"secondary",className:"p-2 gap-1 bg-indigo-100 border-dashed border-indigo-400 text-indigo-700 shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase opacity-50",children:"Status:"}),e.jsx("span",{className:"capitalize text-xs",children:r.statusFilter}),e.jsx("button",{onClick:()=>r.setStatusFilter(""),className:"ml-1 p-0.5 rounded-full hover:bg-slate-100 transition-colors",children:e.jsx(F,{size:12})})]})},"status-chip")})}),u&&e.jsx("div",{className:"hidden sm:block w-0.5 h-6 bg-slate-200 shrink-0"}),e.jsx("div",{className:"shrink-0",children:e.jsxs(L,{children:[e.jsx(O,{asChild:!0,children:e.jsxs(N,{variant:"outline",className:D("h-10 border-brand-aqua/80 shadow-sm bg-brand-aqua/5 hover:bg-brand-aqua/30 transition-all whitespace-nowrap",u&&"border-brand-aqua ring-1 ring-brand-aqua"),children:[e.jsx(we,{strokeWidth:2.5,className:D("h-6 w-6",u?"text-brand-aqua":"text-brand-aqua/60")}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Filters"}),u&&e.jsx("span",{className:"ml-2 flex h-5 w-5 items-center justify-center rounded-full bg-brand-aqua text-[10px] text-white font-bold",children:+!!r.statusFilter})]})}),e.jsxs(V,{align:"end",className:"w-44 p-2 shadow-xl border-slate-200",children:[e.jsx(H,{className:"text-xs text-slate-500 font-bold uppercase tracking-wider",children:"Support Status"}),["open","in_progress","resolved","closed"].map(t=>e.jsx(ee,{className:"capitalize",checked:r.statusFilter===t,onCheckedChange:()=>r.setStatusFilter(t),children:t},t)),e.jsx(P,{}),u&&e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx(k,{className:"text-red-600 justify-center font-medium focus:bg-red-50 focus:text-red-700 cursor-pointer",onClick:()=>{r.setStatusFilter("")},children:"Clear All Filters"})]})]})]})})]})]}),e.jsx("div",{className:"flex justify-end sm:hidden flex-wrap gap-2 px-1",children:e.jsx(_,{children:u&&e.jsx(M.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex flex-wrap items-center gap-2",children:r.statusFilter&&e.jsxs(f,{variant:"secondary",className:"bg-indigo-50 text-indigo-700 border-indigo-100 py-1",children:["Status:",e.jsx("span",{className:"capitalize ml-1",children:r.statusFilter}),e.jsx("button",{onClick:()=>r.setStatusFilter(""),className:"ml-1",children:e.jsx(F,{size:12})})]})})})})]}),e.jsx("div",{className:"block rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden",children:e.jsxs(se,{children:[e.jsx(ae,{className:"bg-slate-50/50",children:o.getHeaderGroups().map(t=>e.jsx(I,{children:t.headers.map(h=>e.jsx(te,{className:"text-slate-700 w-max pl-5 font-semibold h-10 bg-slate-100 text-xs",children:q(h.column.columnDef.header,h.getContext())},h.id))},t.id))}),e.jsx(re,{className:D(g&&"opacity-50 pointer-events-none transition-opacity"),children:o.getRowModel().rows?.length?o.getRowModel().rows.map(t=>e.jsx(I,{className:"hover:bg-slate-50/50",children:t.getVisibleCells().map(h=>e.jsx(z,{className:"py-4 pl-5",children:q(h.column.columnDef.cell,h.getContext())},h.id))},t.id)):e.jsx(I,{children:e.jsx(z,{colSpan:p.length,className:"h-64 text-center",children:g?e.jsx(Ne,{text:"Fetching data..."}):e.jsx(ye,{message:"No support tickets found."})})})})]})}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-4 py-2 border-t border-slate-100 mt-4 px-5 md:px-0",children:[e.jsxs("div",{className:"text-xs font-medium text-slate-500",children:["Showing ",x.length," of ",s," results"]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"hidden sm:block text-[10px] font-bold text-slate-400 uppercase",children:"Rows"}),e.jsxs($,{value:`${o.getState().pagination.pageSize}`,onValueChange:t=>o.setPageSize(Number(t)),children:[e.jsx(U,{className:"h-8 w-[70px] text-xs",children:e.jsx(B,{})}),e.jsx(W,{children:[10,20,50].map(t=>e.jsx(w,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(N,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>o.previousPage(),disabled:!o.getCanPreviousPage(),children:e.jsx(ue,{size:16})}),e.jsxs("div",{className:"text-xs font-semibold px-2",children:[o.getState().pagination.pageIndex+1," /"," ",o.getPageCount()]}),e.jsx(N,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>o.nextPage(),disabled:!o.getCanNextPage(),children:e.jsx(ge,{size:16})})]})]})]})]})}const Oe=(p,x)=>[{accessorKey:"user",header:"Ticket Details",cell:({row:s,table:a})=>{const l=s.original.user,n=l?.avatar||le,c=l?.nickname||"No Nickname";s.original._id;const{setImageModal:d}=a.options.meta||{};return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-9 w-9 rounded-full bg-gray-100 overflow-hidden border flex-shrink-0",children:e.jsx("img",{src:n,alt:"User Avatar",className:"w-full h-full object-cover cursor-pointer hover:scale-110 transition-transform duration-200",onClick:()=>d?.({open:!0,src:n,title:`${c}'s Selfie`})})}),e.jsx("div",{className:"flex flex-col min-w-0",children:e.jsx("span",{className:"font-bold text-gray-900 text-xs truncate",children:c})})]})}},{accessorKey:"user.phone",header:"Contact",cell:({row:s})=>{const a=s.original.user?.phone;if(!a)return e.jsx("span",{className:"text-slate-400 text-xs italic",children:"-"});const l=()=>{navigator.clipboard.writeText(a),toast.success("Phone number copied!")};return e.jsxs(f,{onClick:l,className:"cursor-pointer bg-gray-100 text-gray-700 text-[11px] border-gray-200 hover:bg-gray-200 transition-all",children:[e.jsx(ie,{className:"w-3 h-3 mr-1"}),a]})}},{accessorKey:"user.email",header:()=>e.jsx("div",{className:"w-max text-center text-xs",children:"Email Address"}),cell:({row:s})=>{const a=s.original.user?.email;return a?e.jsxs(f,{className:"lowercase font-normal bg-gray-100 text-[11px] text-gray-700 border border-gray-200 transition-all duration-200 hover:bg-gray-200 hover:scale-105",children:[e.jsx(ne,{className:"w-3 h-3 mr-1.5 text-slate-500"}),a]}):e.jsx("span",{className:"text-slate-400 text-xs italic",children:"-"})}},{accessorKey:"subject",header:"Subject",cell:({row:s})=>e.jsx("div",{className:"flex flex-col max-w-[250px]",children:e.jsx("span",{className:"font-medium text-[12px] text-gray-900 truncate",title:s.getValue("subject"),children:s.getValue("subject")})})},{id:"category",accessorFn:s=>s.category,header:({column:s})=>e.jsxs("button",{className:"flex items-center hover:text-gray-900 transition-colors",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Category",e.jsx(E,{className:"ml-2 h-3 w-3 opacity-50"})]}),cell:({row:s})=>{const a=s.getValue("category");return e.jsxs("div",{className:"flex flex-col max-w-[200px]",children:[e.jsx(f,{variant:"outline",className:"w-fit font-medium text-[11px] py-0 px-2 bg-slate-50 text-slate-600 border-slate-200 capitalize",children:a||"Uncategorized"}),s.original.subCategory&&e.jsx("span",{className:"text-[9px] text-muted-foreground mt-1",children:s.original.subCategory})]})}},{accessorKey:"status",header:"Status",cell:({row:s})=>{const a=(s.original?.status||"open").toLowerCase(),l={open:"bg-blue-100 text-blue-700 border-blue-200",in_progress:"bg-amber-100 text-amber-700 border-amber-200",resolved:"bg-emerald-100 text-emerald-700 border-emerald-200",closed:"bg-slate-100 text-slate-700 border-slate-200"};return e.jsxs(f,{variant:"outline",className:`
          capitalize font-medium transition-all duration-200 hover:scale-105 
          ${l[a]||"bg-gray-100 text-gray-700 border-gray-200"}
        `,children:[a==="open"&&e.jsx("div",{className:"w-1.5 h-1.5 rounded-full bg-blue-500 mr-2 animate-pulse"}),a==="in_progress"&&e.jsx(Ce,{className:"w-3 h-3 mr-1 animate-spin-slow",style:{animationDuration:"3s"}}),a==="resolved"&&e.jsx(ke,{className:"w-3 h-3 mr-1"}),a==="closed"&&e.jsx(Se,{className:"w-3 h-3 mr-1"}),a.replace("_"," ")]})}},{accessorKey:"createdAt",header:({column:s})=>e.jsxs("button",{className:"flex items-center hover:text-gray-900",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Created At",e.jsx(E,{className:"ml-2 h-3 w-3 opacity-50"})]}),cell:({row:s})=>{const a=new Date(s.getValue("createdAt"));return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium text-gray-900",children:Fe(a,{addSuffix:!0})}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[oe(a,"MMM dd, yyyy p")," "]})]})}},{id:"actions",header:()=>e.jsx("div",{className:"w-max text-center mr-4 text-xs",children:"Actions"}),cell:({row:s,table:a})=>{const l=K(),n=s.original,{setSelectedTicket:c,setConfirmConfig:d}=a.options?.meta||{};return e.jsxs(L,{children:[e.jsx(O,{asChild:!0,children:e.jsx(N,{variant:"ghost",className:"h-8 w-8 p-0 hover:bg-slate-100",children:e.jsx(Te,{className:"h-4 w-4 text-slate-600"})})}),e.jsxs(V,{align:"end",className:"w-48 p-2",children:[e.jsx(H,{children:"Actions"}),e.jsxs(k,{onClick:()=>l(`./view-ticket/${n._id}`,{state:{ticketData:n}}),children:[e.jsx(De,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:" View Ticket"})]}),e.jsxs(k,{className:"cursor-pointer gap-2 py-2 text-emerald-600 focus:bg-emerald-50",onClick:()=>c?.(n),children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Update Status"})]}),e.jsxs(k,{className:"cursor-pointer gap-2 py-2 text-red-600 focus:bg-red-50",onClick:()=>d?.({isOpen:!0,ticketId:n._id,nickname:n.user?.nickname||"this user",action:"delete"}),children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Delete Ticket"})]})]})]})}}],Ve=({selectedTicket:p,setSelectedTicket:x,statusUpdate:s,setStatusUpdate:a,reply:l,setReply:n,handleActionSubmit:c,loading:d})=>e.jsx(Me,{open:!!p,onOpenChange:()=>x(null),children:e.jsxs(Pe,{className:"max-w-md gap-2 p-0 overflow-hidden border border-grey-900 shadow-2xl",children:[e.jsxs("div",{className:"bg-gray-900 shadow-lg px-6 py-4 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/10 rounded-lg",children:e.jsx(X,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx(ze,{className:"text-white text-lg font-semibold",children:"Update Ticket"}),e.jsxs("p",{className:"text-gray-400 text-[11px] uppercase tracking-wider font-medium",children:["Ref. ID: ",p?._id?.slice(-8)]})]})]}),e.jsxs("div",{className:"p-4 py-2 space-y-4 bg-white",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("label",{className:"text-[11px] font-bold text-gray-400 uppercase mb-2 block ml-1",children:"User Inquiry"}),e.jsxs("div",{className:"relative bg-slate-50 rounded-2xl p-4 border border-slate-100 italic text-slate-600 text-sm leading-relaxed shadow-sm",children:[e.jsx("span",{className:"absolute -left-1 top-4 w-2 h-2 bg-slate-50 border-l border-b border-slate-100 rotate-45"}),'"',p?.subject,'"']})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700",children:"Ticket Status"}),s==="open"&&e.jsx("span",{className:"text-[10px] text-blue-500 font-medium animate-pulse",children:"Waiting for reply"})]}),e.jsxs($,{value:s,onValueChange:a,children:[e.jsx(U,{className:"w-full bg-white border-slate-200 h-11 focus:ring-gray-900 transition-all",children:e.jsx(B,{placeholder:"Select status"})}),e.jsxs(W,{children:[e.jsx(w,{value:"open",children:"Open"}),e.jsx(w,{value:"in_progress",children:"In Progress"}),e.jsx(w,{value:"resolved",children:"Resolved"}),e.jsx(w,{value:"closed",children:"Closed"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-gray-700",children:"Official Response"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{placeholder:"Draft your reply to the user...",className:"min-h-[120px] text-sm border-slate-200 focus-visible:ring-gray-900 resize-none p-4 rounded-xl shadow-inner",value:l,onChange:g=>n(g.target.value)}),e.jsxs("div",{className:"absolute bottom-3 right-3 text-[10px] text-gray-400",children:[l?.length||0," characters"]})]})]})]})]}),e.jsxs("div",{className:"px-4 py-3 bg-gray-50 flex justify-between gap-3 border-t border-gray-100",children:[e.jsx(N,{variant:"ghost",onClick:()=>x(null),disabled:d,className:"text-gray-500 hover:text-gray-700 font-medium",children:"Discard"}),e.jsx(N,{onClick:c,className:"bg-gray-900 text-white hover:bg-black px-6 rounded-lg transition-all active:scale-95 flex items-center gap-2 shadow-lg shadow-gray-200",disabled:d||!s||!l,children:d?e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"w-4 h-4"}),"Submit Action"]})})]})]})}),He={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.1}}};function us(){const p=K(),x=ce(),s=de(),{tickets:a,pagination:l,loading:n}=xe(i=>i.support),[c,d]=m.useState(""),[g,C]=m.useState(""),[r,j]=m.useState({pageIndex:0,pageSize:10}),[b,o]=m.useState(null),[u,t]=m.useState(""),[h,S]=m.useState(""),[y,T]=m.useState({isOpen:!1,ticketId:null,nickname:""});m.useEffect(()=>{const i=setTimeout(()=>{x(A({page:r.pageIndex+1,limit:r.pageSize,search:c,status:g}))},500);return()=>clearTimeout(i)},[x,r.pageIndex,r.pageSize,c,g]),m.useEffect(()=>{const i=s?.state;i&&(j(v=>({...v,pageIndex:0})),i==="Tickets"&&C("open"))},[s?.state]),m.useEffect(()=>{b&&(t(b.status),S(""))},[b]);const G=m.useMemo(()=>Oe(),[p]),Y=async()=>{if(h.trim())try{const i=await x(R({ticketId:b._id,reply:h,status:u}));R.fulfilled.match(i)&&(S(""),o(null),x(A({page:r.page,limit:r.limit})),setTimeout(()=>x(me()),3e3))}catch(i){console.error("Failed to update ticket:",i)}},Z=async()=>{console.log("Deleting ticket:",y.ticketId),T({...y,isOpen:!1})};return e.jsxs("div",{className:"flex flex-1 flex-col min-h-screen p-4 bg-gradient-to-br from-gray-50 via-blue-50 to-gray-100 pb-8",children:[e.jsxs(M.div,{className:"space-y-6",initial:"hidden",animate:"visible",variants:He,children:[e.jsx("header",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4 px-2",children:e.jsx(he,{heading:"Support Management",icon:e.jsx(qe,{className:"w-9 h-9 text-white animate-pulse"}),color:"bg-red-500 shadow-red-500/20",subheading:"Track and manage customer queries."})}),e.jsx(Le,{columns:G,data:a||[],rowCount:l?.total||0,isLoading:n,pagination:r,onPaginationChange:j,globalFilter:c,setGlobalFilter:i=>{d(i),j(v=>({...v,pageIndex:0}))},searchPlaceholder:"Search...",filters:{statusFilter:g,setStatusFilter:i=>{C(i),j(v=>({...v,pageIndex:0}))}},meta:{setSelectedTicket:i=>o(i),setConfirmConfig:T}}),e.jsx(Ve,{selectedTicket:b,setSelectedTicket:o,statusUpdate:u,setStatusUpdate:t,reply:h,setReply:S,handleActionSubmit:Y,loading:n})]}),e.jsx(Re,{isOpen:y.isOpen,onClose:()=>T({...y,isOpen:!1}),onConfirm:Z,title:"Delete Ticket?",message:`Are you sure you want to delete the ticket from ${y.nickname}? This action is permanent and cannot be undone.`,confirmText:"Delete Permanently",type:"danger"})]})}export{us as default};
