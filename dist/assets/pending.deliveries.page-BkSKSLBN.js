import{r as p,j as e,H as T,z as S,B as y,W as R,Y as E,E as j,a as N,Z as A,$ as F,a0 as L,a1 as q,_ as G,a2 as V,a3 as _,a4 as v,a5 as B,a6 as K,a7 as C,J as U,ah as H,i as $,A as W,cd as D,ce as J,N as k}from"./index-Cah9GgNi.js";import{u as X,f as I,a as Y,b as Z,g as O,c as Q}from"./index-BXaOFAvc.js";import{L as ee}from"./label-DJ1n1SI_.js";import{S as ae,a as se,b as te,c as le,d as re}from"./select-DxUcbfzd.js";import{T as ie,D as ne}from"./data.not-found-BokaeWBd.js";import{I as oe,a as w}from"./IconX-D4kkSzeq.js";import{A as P}from"./index-Eb3V4Lej.js";import{I as ce}from"./IconFilter-D5y8yHeQ.js";import{U as de}from"./user-D1L96pnc.js";import{G as z}from"./gift-CJDpdJoS.js";import{A as xe}from"./arrow-up-down-CNYF-QmJ.js";import{C as M}from"./circle-check-big-ChBinIN1.js";import{C as me}from"./clock-BveIEetd.js";import{T as pe,P as he}from"./truck-Dz2wWr1L.js";import{L as ue}from"./loader-circle-D_OERo1u.js";import{C as ge}from"./circle-dollar-sign-U1pwusAR.js";import{C as je}from"./crown-4cfT-ZjR.js";import{f as fe}from"./formatDistanceToNow-SCnc4N16.js";import"./index-657d2hlm.js";import"./IconLoader-QBct0fFV.js";import"./endOfMonth-D35K41iH.js";function be({columns:o,data:h,rowCount:t,pagination:s,onPaginationChange:l,searchPlaceholder:c="Search...",globalFilter:d,setGlobalFilter:u,isLoading:x,meta:f,filters:i}){const[g,b]=p.useState([]),n=X({data:h,columns:o,rowCount:t,onSortingChange:b,manualSorting:!1,manualPagination:!0,manualFiltering:!0,onPaginationChange:l,onGlobalFilterChange:u,getSortedRowModel:Q(),getCoreRowModel:O(),state:{sorting:g,pagination:s,globalFilter:d},meta:f}),r=i.deliveryStatus;return e.jsxs("div",{className:"w-full space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-row md:items-center justify-between gap-4 bg-slate-50/50 p-2 rounded-xl",children:[e.jsxs("div",{className:"relative w-3/5 md:w-1/3",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400 z-10"}),e.jsx(T,{placeholder:c,className:"pl-9 pr-10 bg-white border-slate-200 h-10 shadow-md focus-visible:ring-brand-aqua rounded-lg",value:d??"",onChange:a=>u(a.target.value)}),d&&e.jsx("button",{onClick:()=>u(""),className:"absolute right-3 top-1/2 -translate-y-1/2 group flex items-center justify-center rounded-full p-1 bg-brand-aqua/30 hover:bg-brand-aqua transition-colors duration-200","aria-label":"Clear search",children:e.jsx(w,{className:"h-4 w-4 text-slate-600 group-hover:text-slate-800 transition-colors"})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-3 min-w-0 flex-1 ml-4",children:[e.jsx("div",{className:"hidden sm:flex flex-1 items-center justify-end gap-2 overflow-x-hidden min-w-0",children:e.jsx(P,{mode:"popLayout",children:r&&e.jsx(S.div,{initial:{opacity:0,x:10},animate:{opacity:1,x:0},exit:{opacity:0,scale:.95},className:"shrink-0",children:e.jsxs(y,{variant:"secondary",className:"p-2 gap-1 bg-indigo-100 border-dashed border-indigo-400 text-indigo-700 shadow-sm whitespace-nowrap",children:[e.jsx("span",{className:"text-[10px] font-bold uppercase opacity-50",children:"Status:"}),e.jsx("span",{className:"capitalize text-xs",children:i.deliveryStatus}),e.jsx("button",{onClick:()=>i.setDeliveryStatus(""),className:"ml-1 p-0.5 rounded-full hover:bg-slate-100 transition-colors",children:e.jsx(w,{size:12})})]})},"status-chip")})}),r&&e.jsx("div",{className:"hidden sm:block w-0.5 h-6 bg-slate-200 shrink-0"}),e.jsx("div",{className:"shrink-0",children:e.jsxs(R,{children:[e.jsx(E,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:N("h-10 border-brand-aqua/80 shadow-sm bg-brand-aqua/5 hover:bg-brand-aqua/30 transition-all whitespace-nowrap",r&&"border-brand-aqua ring-1 ring-brand-aqua"),children:[e.jsx(ce,{strokeWidth:2.5,className:N("h-6 w-6",r?"text-brand-aqua":"text-brand-aqua/60")}),e.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Filters"}),r&&e.jsx("span",{className:"ml-2 flex h-5 w-5 items-center justify-center rounded-full bg-brand-aqua text-[10px] text-white font-bold",children:+!!i.deliveryStatus})]})}),e.jsxs(A,{align:"end",className:"w-44 p-2 shadow-xl",children:[e.jsx(F,{className:"text-xs text-slate-500 font-bold uppercase",children:"Delivery Status"}),["PENDING","DELIVERED"].map(a=>e.jsx(L,{className:"capitalize",checked:i.deliveryStatus===a,onCheckedChange:()=>i.setDeliveryStatus(a),children:a.toLowerCase()},a)),r&&e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsx(G,{className:"text-red-600 justify-center font-medium focus:bg-red-50 focus:text-red-700 cursor-pointer",onClick:()=>{i.setDeliveryStatus("")},children:"Clear All Filters"})]})]})]})})]})]}),e.jsx("div",{className:"flex justify-end sm:hidden flex-wrap gap-2 px-1",children:e.jsx(P,{children:r&&e.jsx(S.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex flex-wrap items-center gap-2",children:i.deliveryStatus&&e.jsxs(y,{variant:"secondary",className:"bg-indigo-50 text-indigo-700 border-indigo-100 py-1",children:["Status:",e.jsx("span",{className:"capitalize ml-1",children:i.deliveryStatus}),e.jsx("button",{onClick:()=>i.setDeliveryStatus(""),className:"ml-1",children:e.jsx(w,{size:12})})]})})})})]}),e.jsx("div",{className:"block rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden",children:e.jsxs(V,{children:[e.jsx(_,{className:"bg-slate-50/50",children:n.getHeaderGroups().map(a=>e.jsx(v,{children:a.headers.map(m=>e.jsx(B,{className:"text-slate-700 w-max pl-10 font-semibold h-10 bg-slate-100 text-xs",children:I(m.column.columnDef.header,m.getContext())},m.id))},a.id))}),e.jsx(K,{className:N(x&&"opacity-50 pointer-events-none transition-opacity"),children:n.getRowModel().rows?.length?n.getRowModel().rows.map(a=>e.jsx(v,{className:"hover:bg-slate-50/50",children:a.getVisibleCells().map(m=>e.jsx(C,{className:"py-3 pl-10",children:I(m.column.columnDef.cell,m.getContext())},m.id))},a.id)):e.jsx(v,{children:e.jsx(C,{colSpan:o.length,className:"h-64 text-center",children:x?e.jsx(ie,{text:"Fetching Campaigns..."}):e.jsx(ne,{message:"No campaigns found"})})})})]})}),e.jsxs("div",{className:"flex flex-row items-center justify-between gap-4 py-2 border-t border-slate-100 mt-4 px-5 md:px-0",children:[e.jsxs("div",{className:"text-xs font-medium text-slate-500",children:["Showing ",h.length," of ",t," results"]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"hidden sm:block text-[10px] font-bold text-slate-400 uppercase",children:"Rows"}),e.jsxs(ae,{value:`${n.getState().pagination.pageSize}`,onValueChange:a=>n.setPageSize(Number(a)),children:[e.jsx(se,{className:"h-8 w-[70px] text-xs",children:e.jsx(te,{})}),e.jsx(le,{children:[10,20,50].map(a=>e.jsx(re,{value:`${a}`,children:a},a))})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>n.previousPage(),disabled:!n.getCanPreviousPage(),children:e.jsx(Y,{size:16})}),e.jsxs("div",{className:"text-xs font-semibold px-2",children:[n.getState().pagination.pageIndex+1," /"," ",n.getPageCount()]}),e.jsx(j,{variant:"outline",size:"icon",className:"h-8 w-8",onClick:()=>n.nextPage(),disabled:!n.getCanNextPage(),children:e.jsx(Z,{size:16})})]})]})]})]})}const Ne=(o,h)=>[{accessorKey:"user",header:"Winner",cell:({row:t})=>{const s=t.original.user;return e.jsx("div",{className:"flex flex-col",children:e.jsxs("div",{className:"flex items-center gap-2 group",children:[e.jsx(de,{className:"h-4 w-4 text-blue-600 transition-all group-hover:scale-110"}),e.jsx("span",{className:"font-bold text-slate-900",children:s?.phone||s?.email||"-"})]})})}},{accessorKey:"prize.title",header:"Prize",cell:({row:t})=>{const s=t.original.prize;return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2 group",children:[e.jsx(z,{className:"h-4 w-4 text-slate-900 transition-all group-hover:scale-110"}),e.jsx("span",{className:"font-bold text-slate-900",children:s?.title||"-"})]}),s?.value&&e.jsxs("span",{className:"text-[10px] text-slate-500 ml-6",children:["Value: ",s.value]})]})}},{accessorKey:"prize.type",header:"Type",cell:({row:t})=>{const s=t?.original.prize?.type,l={FREE_PREMIUM:"bg-amber-50 text-amber-700 border-amber-200",GIFT_CARD:"bg-emerald-50 text-emerald-700 border-emerald-200"},c={FREE_PREMIUM:e.jsx(je,{className:"h-3.5 w-3.5"}),GIFT_CARD:e.jsx(ge,{className:"h-3.5 w-3.5"})};return e.jsxs(y,{variant:"outline",className:`${l[s]||"bg-gray-50"} flex w-fit items-center gap-1`,children:[c[s]||e.jsx(z,{className:"h-3.5 w-3.5"}),s]})}},{accessorKey:"campaign.date",header:({column:t})=>e.jsxs("button",{className:"flex items-center hover:text-gray-900 transition-colors",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Campaign Date",e.jsx(xe,{className:"ml-2 h-3 w-3 opacity-50"})]}),cell:({row:t})=>{const s=t.original.campaign?.date;if(!s)return e.jsx("span",{className:"text-sm text-slate-400 italic",children:"â€”"});const l=new Date(s);return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs font-medium text-slate-900",children:fe(l,{addSuffix:!0})}),e.jsxs("div",{className:"flex items-center gap-1 text-[10px] text-slate-500",children:[e.jsx(U,{className:"h-2.5 w-2.5 opacity-70"}),e.jsx("span",{children:H(l,"MMM dd, yyyy p")})]})]})}},{accessorKey:"deliveryStatus",header:"Status",cell:({row:t})=>{const{deliveryStatus:s,claimedAt:l}=t.original;return s==="DELIVERED"?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase bg-emerald-50 text-emerald-700 border border-emerald-200",children:[e.jsx(M,{className:"w-3 h-3"})," Delivered"]}):l?s==="PENDING"?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase bg-amber-50 text-amber-700 border border-amber-200",children:[e.jsx(pe,{className:"w-3 h-3"})," Pending"]}):null:e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-0.5 rounded-full text-[10px] font-bold uppercase bg-slate-50 text-slate-500 border border-slate-200",children:[e.jsx(me,{className:"w-3 h-3"})," Not Claimed"]})}},{id:"actions",header:()=>e.jsx("div",{className:"text-right",children:"Action"}),cell:({row:t})=>{const s=t?.original,l=h[s._id];return s.deliveryStatus==="PENDING"&&s.claimedAt?e.jsx("div",{className:"text-right",children:e.jsxs(j,{size:"sm",onClick:()=>o(s._id),disabled:l,className:"bg-slate-900 hover:bg-slate-800 text-white h-8 text-xs gap-2 shadow-md transition-all active:scale-95",children:[l?e.jsx(ue,{className:"w-3 h-3 animate-spin"}):e.jsx(M,{className:"w-3 h-3"}),"Mark Delivered"]})}):e.jsx("div",{className:"text-right",children:e.jsx("span",{className:"text-xs text-slate-400 italic",children:"No Action"})})}}];function Be(){const o=$(),{deliveries:h,pagination:t,loading:s}=W(r=>r.delivery),[l,c]=p.useState({pageIndex:0,pageSize:10}),[d,u]=p.useState(""),[x,f]=p.useState(""),[i,g]=p.useState({});p.useEffect(()=>{const r=setTimeout(()=>{o(D({page:l.pageIndex+1,limit:l.pageSize,search:d,deliveryStatus:x}))},400);return()=>clearTimeout(r)},[o,l.pageIndex,l.pageSize,d,x]);const b=async r=>{g(a=>({...a,[r]:!0}));try{await o(J(r)).unwrap(),k.success("Prize marked as delivered successfully"),o(D({page:l.pageIndex+1,limit:l.pageSize,deliveryStatus:x}))}catch(a){k.error(a?.message||"Failed to update status")}finally{g(a=>({...a,[r]:!1}))}},n=p.useMemo(()=>Ne(b,i),[i]);return e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-brand-aqua p-3 rounded-xl shadow-lg",children:e.jsx(he,{className:"h-5 w-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold tracking-tight",children:"Delivery Management"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Track and fulfill giveaway prizes"})]})]})}),e.jsx("div",{className:"overflow-hidden",children:e.jsx(be,{columns:n,data:h||[],rowCount:t?.total||0,isLoading:s,pagination:l,onPaginationChange:c,globalFilter:d,setGlobalFilter:r=>{u(r),c(a=>({...a,pageIndex:0}))},searchPlaceholder:"Search user email, phone, prize title...",filters:{deliveryStatus:x,setDeliveryStatus:r=>{f(r),c(a=>({...a,pageIndex:0}))}}})})]})}export{Be as default};
